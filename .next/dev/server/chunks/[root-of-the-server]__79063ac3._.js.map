{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Forex-Journal/src/app/api/trades/route.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport demoTrades from '../../../../data/demo-trades.json';\r\n\r\nlet prisma: PrismaClient | null = null;\r\ntry {\r\n  prisma = new PrismaClient();\r\n} catch (e) {\r\n  console.warn('Prisma client failed to initialize, falling back to demo data', e);\r\n  prisma = null;\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  const userId = request.headers.get('x-user-id') || 'demo-user';\r\n\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const pair = searchParams.get('pair');\r\n    const startDate = searchParams.get('startDate');\r\n    const endDate = searchParams.get('endDate');\r\n    const outcome = searchParams.get('outcome');\r\n    const status = searchParams.get('status');\r\n    const account = searchParams.get('account');\r\n    const strategy = searchParams.get('strategy');\r\n\r\n    const where: any = { userId };\r\n\r\n    if (pair) where.pair = pair;\r\n    if (outcome) where.outcome = outcome;\r\n    if (status) where.status = status;\r\n    if (account) where.account = account;\r\n    if (strategy) where.strategy = strategy;\r\n    if (startDate || endDate) {\r\n      where.entryTime = {};\r\n      if (startDate) where.entryTime.gte = new Date(startDate);\r\n      if (endDate) where.entryTime.lte = new Date(endDate);\r\n    }\r\n\r\n    if (!prisma) {\r\n      console.warn('Prisma not available, returning demo trades');\r\n      // Optionally, apply filters on demo data\r\n      const demo = (demoTrades as any[])\r\n        .filter(t => t.userId === userId || !t.userId)\r\n        .slice(0, 100);\r\n      return NextResponse.json(demo);\r\n    }\r\n\r\n    const trades = await prisma.trade.findMany({\r\n      where,\r\n      orderBy: { entryTime: 'desc' },\r\n      include: {\r\n        screenshots: true,\r\n        voiceNotes: true,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(trades);\r\n  } catch (error) {\r\n    console.error('Error fetching trades:', error);\r\n    // On error, fall back to demo data so the frontend remains usable\r\n    const demo = (demoTrades as any[])\r\n      .filter(t => t.userId === userId || !t.userId)\r\n      .slice(0, 100);\r\n    return NextResponse.json(demo);\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const userId = request.headers.get('x-user-id') || 'demo-user';\r\n    const body = await request.json();\r\n\r\n    const trade = await prisma.trade.create({\r\n      data: {\r\n        userId,\r\n        pair: body.pair,\r\n        direction: body.direction,\r\n        entryPrice: parseFloat(body.entryPrice),\r\n        exitPrice: body.exitPrice ? parseFloat(body.exitPrice) : null,\r\n        entryTime: new Date(body.entryTime),\r\n        exitTime: body.exitTime ? new Date(body.exitTime) : null,\r\n        volume: parseFloat(body.volume || 0),\r\n        stopLoss: body.stopLoss ? parseFloat(body.stopLoss) : null,\r\n        takeProfit: body.takeProfit ? parseFloat(body.takeProfit) : null,\r\n        riskAmount: body.riskAmount ? parseFloat(body.riskAmount) : null,\r\n        riskPercent: body.riskPercent ? parseFloat(body.riskPercent) : null,\r\n        riskRewardRatio: body.riskRewardRatio ? parseFloat(body.riskRewardRatio) : null,\r\n        account: body.account,\r\n        broker: body.broker,\r\n        accountBalance: body.accountBalance ? parseFloat(body.accountBalance) : null,\r\n        accountEquity: body.accountEquity ? parseFloat(body.accountEquity) : null,\r\n        profitLoss: body.profitLoss ? parseFloat(body.profitLoss) : null,\r\n        profitLossPercent: body.profitLossPercent ? parseFloat(body.profitLossPercent) : null,\r\n        outcome: body.outcome,\r\n        status: body.status || 'open',\r\n        strategy: body.strategy,\r\n        setupType: body.setupType,\r\n        notes: body.notes,\r\n        emotionalState: body.emotionalState,\r\n        setupQuality: body.setupQuality ? parseInt(body.setupQuality) : null,\r\n        whatLearned: body.whatLearned,\r\n        mistakes: body.mistakes ? JSON.stringify(body.mistakes) : null,\r\n      },\r\n      include: {\r\n        screenshots: true,\r\n        voiceNotes: true,\r\n      },\r\n    });\r\n\r\n    return NextResponse.json(trade, { status: 201 });\r\n  } catch (error) {\r\n    console.error('Error creating trade:', error);\r\n    return NextResponse.json({ error: 'Failed to create trade' }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":"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"}}]
}