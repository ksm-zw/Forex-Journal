{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Forex-Journal/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\n// Safe Prisma provider: only instantiate Prisma when DATABASE_URL looks valid for supported providers.\n// This prevents dev servers and serverless hosts without DB configured from crashing.\nlet prisma: PrismaClient | null = null;\n\ntry {\n  const url = process.env.DATABASE_URL || '';\n  const normalized = url.trim();\n  const isSqlite = normalized.startsWith('file:');\n  const isPg = normalized.startsWith('postgres') || normalized.startsWith('postgresql:');\n\n  if (normalized && (isSqlite || isPg)) {\n    prisma = new PrismaClient();\n  } else {\n    // No valid DATABASE_URL set; leave prisma null so callers can fallback\n    console.warn('Prisma disabled: DATABASE_URL not set to sqlite or postgres. Falling back to demo/resilient behavior.');\n  }\n} catch (err) {\n  console.warn('Failed to initialize Prisma client:', err);\n  prisma = null;\n}\n\nexport { prisma };\n"],"names":[],"mappings":";;;;AAAA;;AAEA,uGAAuG;AACvG,sFAAsF;AACtF,IAAI,SAA8B;AAElC,IAAI;IACF,MAAM,MAAM,QAAQ,GAAG,CAAC,YAAY,IAAI;IACxC,MAAM,aAAa,IAAI,IAAI;IAC3B,MAAM,WAAW,WAAW,UAAU,CAAC;IACvC,MAAM,OAAO,WAAW,UAAU,CAAC,eAAe,WAAW,UAAU,CAAC;IAExE,IAAI,cAAc,CAAC,YAAY,IAAI,GAAG;QACpC,SAAS,IAAI,sMAAY;IAC3B,OAAO;QACL,uEAAuE;QACvE,QAAQ,IAAI,CAAC;IACf;AACF,EAAE,OAAO,KAAK;IACZ,QAAQ,IAAI,CAAC,uCAAuC;IACpD,SAAS;AACX"}},
    {"offset": {"line": 75, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Forex-Journal/src/app/api/strategies/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\n\n/**\n * GET /api/strategies/[id]\n * Fetch a single strategy with all relations\n */\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const userId = request.headers.get('x-user-id') || 'demo-user';\n\n    if (!prisma) {\n      return NextResponse.json(\n        { error: 'Database not available' },\n        { status: 503 }\n      );\n    }\n\n    const strategy = await prisma.strategy.findUnique({\n      where: { id },\n      include: {\n        entry_models: true,\n        timeframe_roles: { orderBy: { order_index: 'asc' } },\n        rules: true,\n        trades: { select: { id: true } },\n      },\n    });\n\n    if (!strategy || strategy.userId !== userId) {\n      return NextResponse.json(\n        { error: 'Strategy not found' },\n        { status: 404 }\n      );\n    }\n\n    return NextResponse.json({ success: true, strategy });\n  } catch (error) {\n    console.error('Error fetching strategy:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch strategy' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * PUT /api/strategies/[id]\n * Update a strategy\n */\nexport async function PUT(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const userId = request.headers.get('x-user-id') || 'demo-user';\n    const body = await request.json();\n\n    if (!prisma) {\n      return NextResponse.json(\n        { error: 'Database not available' },\n        { status: 503 }\n      );\n    }\n\n    const strategy = await prisma.strategy.findUnique({\n      where: { id },\n    });\n\n    if (!strategy || strategy.userId !== userId) {\n      return NextResponse.json(\n        { error: 'Strategy not found' },\n        { status: 404 }\n      );\n    }\n\n    const updated = await prisma.strategy.update({\n      where: { id },\n      data: {\n        strategy_name: body.strategy_name || strategy.strategy_name,\n        description: body.description ?? strategy.description,\n        market_type: body.market_type || strategy.market_type,\n        allowed_sessions: body.allowed_sessions || strategy.allowed_sessions,\n        max_trades_per_day: body.max_trades_per_day ?? strategy.max_trades_per_day,\n        default_risk_percent: body.default_risk_percent ?? strategy.default_risk_percent,\n        expected_rr_min: body.expected_rr_min ?? strategy.expected_rr_min,\n        status: body.status || strategy.status,\n      },\n    });\n\n    return NextResponse.json({ success: true, strategy: updated });\n  } catch (error) {\n    console.error('Error updating strategy:', error);\n    return NextResponse.json(\n      { error: 'Failed to update strategy' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * DELETE /api/strategies/[id]\n * Delete a strategy (cascade deletes related data)\n */\nexport async function DELETE(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  try {\n    const { id } = await params;\n    const userId = request.headers.get('x-user-id') || 'demo-user';\n\n    if (!prisma) {\n      return NextResponse.json(\n        { error: 'Database not available' },\n        { status: 503 }\n      );\n    }\n\n    const strategy = await prisma.strategy.findUnique({\n      where: { id },\n    });\n\n    if (!strategy || strategy.userId !== userId) {\n      return NextResponse.json(\n        { error: 'Strategy not found' },\n        { status: 404 }\n      );\n    }\n\n    await prisma.strategy.delete({\n      where: { id },\n    });\n\n    return NextResponse.json({ success: true, message: 'Strategy deleted' });\n  } catch (error) {\n    console.error('Error deleting strategy:', error);\n    return NextResponse.json(\n      { error: 'Failed to delete strategy' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}