{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Forex-Journal/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\n// Safe Prisma provider: only instantiate Prisma when DATABASE_URL looks valid for supported providers.\n// This prevents dev servers and serverless hosts without DB configured from crashing.\nlet prisma: PrismaClient | null = null;\n\ntry {\n  const url = process.env.DATABASE_URL || '';\n  const normalized = url.trim();\n  const isSqlite = normalized.startsWith('file:');\n  const isPg = normalized.startsWith('postgres') || normalized.startsWith('postgresql:');\n\n  if (normalized && (isSqlite || isPg)) {\n    prisma = new PrismaClient();\n  } else {\n    // No valid DATABASE_URL set; leave prisma null so callers can fallback\n    console.warn('Prisma disabled: DATABASE_URL not set to sqlite or postgres. Falling back to demo/resilient behavior.');\n  }\n} catch (err) {\n  console.warn('Failed to initialize Prisma client:', err);\n  prisma = null;\n}\n\nexport { prisma };\n"],"names":[],"mappings":";;;;AAAA;;AAEA,uGAAuG;AACvG,sFAAsF;AACtF,IAAI,SAA8B;AAElC,IAAI;IACF,MAAM,MAAM,QAAQ,GAAG,CAAC,YAAY,IAAI;IACxC,MAAM,aAAa,IAAI,IAAI;IAC3B,MAAM,WAAW,WAAW,UAAU,CAAC;IACvC,MAAM,OAAO,WAAW,UAAU,CAAC,eAAe,WAAW,UAAU,CAAC;IAExE,IAAI,cAAc,CAAC,YAAY,IAAI,GAAG;QACpC,SAAS,IAAI,sMAAY;IAC3B,OAAO;QACL,uEAAuE;QACvE,QAAQ,IAAI,CAAC;IACf;AACF,EAAE,OAAO,KAAK;IACZ,QAAQ,IAAI,CAAC,uCAAuC;IACpD,SAAS;AACX"}},
    {"offset": {"line": 75, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/Forex-Journal/src/app/api/strategies/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\n\n/**\n * GET /api/strategies\n * List all strategies for the authenticated user with counts\n */\nexport async function GET(request: NextRequest) {\n  try {\n    const userIdentifier = request.headers.get('x-user-id') || 'demo@forex-research.com';\n\n    if (!prisma) {\n      return NextResponse.json(\n        { error: 'Database not available' },\n        { status: 503 }\n      );\n    }\n\n    // Find user by email or ID\n    let user = await prisma.user.findUnique({\n      where: { email: userIdentifier },\n    });\n\n    // If not found by email, try by ID\n    if (!user) {\n      user = await prisma.user.findUnique({\n        where: { id: userIdentifier },\n      });\n    }\n\n    if (!user) {\n      return NextResponse.json(\n        { error: 'User not found' },\n        { status: 404 }\n      );\n    }\n\n    const strategies = await prisma.strategy.findMany({\n      where: { userId: user.id },\n      include: {\n        _count: {\n          select: { trades: true, entry_models: true, rules: true, timeframe_roles: true },\n        },\n      },\n      orderBy: { createdAt: 'desc' },\n    });\n\n    return NextResponse.json({ success: true, strategies });\n  } catch (error) {\n    console.error('Error fetching strategies:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch strategies' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST /api/strategies\n * Create a new strategy\n */\nexport async function POST(request: NextRequest) {\n  try {\n    const userId = request.headers.get('x-user-id') || 'demo-user';\n    const body = await request.json();\n\n    if (!prisma) {\n      return NextResponse.json(\n        { error: 'Database not available' },\n        { status: 503 }\n      );\n    }\n\n    if (!body.strategy_name) {\n      return NextResponse.json(\n        { error: 'Strategy name is required' },\n        { status: 400 }\n      );\n    }\n\n    const strategy = await prisma.strategy.create({\n      data: {\n        userId,\n        strategy_name: body.strategy_name,\n        description: body.description || '',\n        market_type: body.market_type || 'mixed',\n        allowed_sessions: body.allowed_sessions || 'Asia,London,NY',\n        max_trades_per_day: body.max_trades_per_day || 5,\n        default_risk_percent: body.default_risk_percent || 2.0,\n        expected_rr_min: body.expected_rr_min || 1.5,\n        status: 'active',\n      },\n    });\n\n    return NextResponse.json(\n      { success: true, strategy },\n      { status: 201 }\n    );\n  } catch (error) {\n    console.error('Error creating strategy:', error);\n    return NextResponse.json(\n      { error: 'Failed to create strategy' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAMO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,iBAAiB,QAAQ,OAAO,CAAC,GAAG,CAAC,gBAAgB;QAE3D,IAAI,CAAC,gIAAM,EAAE;YACX,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,2BAA2B;QAC3B,IAAI,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACtC,OAAO;gBAAE,OAAO;YAAe;QACjC;QAEA,mCAAmC;QACnC,IAAI,CAAC,MAAM;YACT,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;gBAClC,OAAO;oBAAE,IAAI;gBAAe;YAC9B;QACF;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAiB,GAC1B;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,aAAa,MAAM,gIAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;YAChD,OAAO;gBAAE,QAAQ,KAAK,EAAE;YAAC;YACzB,SAAS;gBACP,QAAQ;oBACN,QAAQ;wBAAE,QAAQ;wBAAM,cAAc;wBAAM,OAAO;wBAAM,iBAAiB;oBAAK;gBACjF;YACF;YACA,SAAS;gBAAE,WAAW;YAAO;QAC/B;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;QAAW;IACvD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA6B,GACtC;YAAE,QAAQ;QAAI;IAElB;AACF;AAMO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC,gBAAgB;QACnD,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,IAAI,CAAC,gIAAM,EAAE;YACX,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,CAAC,KAAK,aAAa,EAAE;YACvB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA4B,GACrC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,WAAW,MAAM,gIAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;YAC5C,MAAM;gBACJ;gBACA,eAAe,KAAK,aAAa;gBACjC,aAAa,KAAK,WAAW,IAAI;gBACjC,aAAa,KAAK,WAAW,IAAI;gBACjC,kBAAkB,KAAK,gBAAgB,IAAI;gBAC3C,oBAAoB,KAAK,kBAAkB,IAAI;gBAC/C,sBAAsB,KAAK,oBAAoB,IAAI;gBACnD,iBAAiB,KAAK,eAAe,IAAI;gBACzC,QAAQ;YACV;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAM;QAAS,GAC1B;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA4B,GACrC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}