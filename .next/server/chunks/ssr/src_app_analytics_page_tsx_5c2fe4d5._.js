module.exports=[16683,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(57431),e=a.i(77924),f=a.i(85811),g=a.i(98621),h=a.i(88949),i=a.i(25428),j=a.i(74668),k=a.i(68932),l=a.i(99738),m=a.i(17792),n=a.i(77368),o=a.i(12168),p=a.i(25392),q=a.i(61970),r=a.i(7038),s=a.i(87293),t=a.i(96268);function u(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function v(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?u(Object(c),!0).forEach(function(b){var d,e,f;d=a,e=b,f=c[b],(e=function(a){var b=function(a,b){if("object"!=typeof a||!a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var d=c.call(a,b||"default");if("object"!=typeof d)return d;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}(a,"string");return"symbol"==typeof b?b:b+""}(e))in d?Object.defineProperty(d,e,{value:f,enumerable:!0,configurable:!0,writable:!0}):d[e]=f}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):u(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}function w(){return(w=Object.assign.bind()).apply(null,arguments)}function x(a){var b=(0,n.useAppDispatch)();return(0,c.useEffect)(()=>(b((0,m.addDot)(a)),()=>{b((0,m.removeDot)(a))})),null}function y(a){var{x:b,y:d,r:e}=a,f=(0,q.useClipPathId)(),m=((a,b,c,d,e)=>{var f=(0,k.isNumOrStr)(a),g=(0,k.isNumOrStr)(b),h=(0,p.useIsPanorama)(),i=(0,n.useAppSelector)(a=>(0,o.selectAxisScale)(a,"xAxis",c,h)),j=(0,n.useAppSelector)(a=>(0,o.selectAxisScale)(a,"yAxis",d,h));if(!f||!g||null==i||null==j)return null;var m=(0,l.createLabeledScales)({x:i,y:j}),q=m.apply({x:a,y:b},{bandAware:!0});return"discard"!==e||m.isInRange(q)?q:null})(b,d,a.xAxisId,a.yAxisId,a.ifOverflow);if(!m)return null;var{x:s,y:u}=m,{shape:x,className:y,ifOverflow:z}=a,A=v(v({clipPath:"hidden"===z?"url(#".concat(f,")"):void 0},(0,r.svgPropertiesAndEvents)(a)),{},{cx:s,cy:u});return c.createElement(t.ZIndexLayer,{zIndex:a.zIndex},c.createElement(h.Layer,{className:(0,g.clsx)("recharts-reference-dot",y)},c.isValidElement(x)?c.cloneElement(x,A):"function"==typeof x?x(A):c.createElement(i.Dot,w({},A,{cx:A.cx,cy:A.cy,className:"recharts-reference-dot-dot"})),c.createElement(j.CartesianLabelContextProvider,{x:s-e,y:u-e,width:2*e,height:2*e,upperWidth:2*e,lowerWidth:2*e},c.createElement(j.CartesianLabelFromLabelProp,{label:a.label}),a.children)))}var z={ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1,zIndex:a.i(31080).DefaultZIndexes.scatter};function A(a){var b=(0,s.resolveDefaultProps)(a,z),{x:d,y:e,r:f,ifOverflow:g,yAxisId:h,xAxisId:i}=b;return c.createElement(c.Fragment,null,c.createElement(x,{y:e,x:d,r:f,yAxisId:h,xAxisId:i,ifOverflow:g}),c.createElement(y,b))}A.displayName="ReferenceDot";var B=a.i(18155),C=a.i(23665),D=a.i(64321),E=a.i(27165),F=a.i(67149),G=a.i(58042),H=a.i(94222),I=a.i(54419),J=a.i(59854),K=a.i(2274),L=a.i(48662),M=a.i(19721);let N=(0,M.default)(async()=>{},{loadableGenerated:{modules:[61392]},ssr:!1}),O=(0,M.default)(async()=>{},{loadableGenerated:{modules:[96909]},ssr:!1});function P({trades:a,startDate:g,endDate:h}){let[i,j]=(0,c.useState)({dailyPnL:[],pairPerformance:[],directionPerformance:[],equity:[]});(0,c.useEffect)(()=>{if(!a.length)return;let b=a;(g||h)&&(b=a.filter(a=>{let b=new Date(a.entryTime);return!(g&&new Date(b.toISOString().slice(0,10))<new Date(g)||h&&new Date(b.toISOString().slice(0,10))>new Date(h))}));let c={};b.forEach(a=>{let b=new Date(a.entryTime).toLocaleDateString();c[b]=(c[b]||0)+(a.profitLoss||0)});let d=Object.entries(c).map(([a,b])=>({date:a,pnl:Math.round(100*b)/100})),e={};a.forEach(a=>{e[a.pair]||(e[a.pair]={wins:0,losses:0,pnl:0}),"WIN"===a.outcome&&e[a.pair].wins++,"LOSS"===a.outcome&&e[a.pair].losses++,e[a.pair].pnl+=a.profitLoss||0});let f=Object.entries(e).map(([a,b])=>({pair:a,wins:b.wins,losses:b.losses,pnl:Math.round(100*b.pnl)/100})),i={LONG:{wins:0,losses:0},SHORT:{wins:0,losses:0}};a.forEach(a=>{"WIN"===a.outcome?i[a.direction].wins++:"LOSS"===a.outcome&&i[a.direction].losses++});let k=Object.entries(i).map(([a,b])=>({direction:a,value:b.wins,name:`${a} (${b.wins} wins)`})),l=[...b].sort((a,b)=>new Date(a.entryTime).getTime()-new Date(b.entryTime).getTime()),m=0,n=-1/0,o=l.map(a=>{m+=a.profitLoss||0;let b=Math.round(((n=Math.max(n,m))-m)*100)/100;return{date:new Date(a.entryTime).toLocaleDateString(),equity:Math.round(100*m)/100,drawdown:b}});o.reduce((a,b)=>Math.max(a,b.drawdown),0),o.length&&o.reduce((a,b)=>b.equity>a.equity?b:a,o[0]),o.length&&o.reduce((a,b)=>b.equity<a.equity?b:a,o[0]),j({dailyPnL:d,pairPerformance:f,directionPerformance:k,equity:o})},[a]);let k=i.equity.length?i.equity.reduce((a,b)=>b.equity>a.equity?b:a,i.equity[0]):null,l=i.equity.length?i.equity.reduce((a,b)=>b.equity<a.equity?b:a,i.equity[0]):null,m=["#10b981","#ef4444"];return(0,b.jsxs)("div",{className:"space-y-8",children:[i.equity.length>0&&(0,b.jsxs)("div",{className:"card-glass rounded-lg p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-200 mb-4",children:"Equity Curve (Live)"}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)(N,{selector:".recharts-wrapper",filename:`equity-${new Date().toISOString().slice(0,10)}.png`})})]}),(0,b.jsx)(L.ResponsiveContainer,{width:"100%",height:320,children:(0,b.jsxs)(d.LineChart,{data:i.equity,className:"equity-chart",children:["              ",(0,b.jsx)(I.CartesianGrid,{strokeDasharray:"3 3",stroke:"#111827"}),(0,b.jsx)(G.XAxis,{dataKey:"date",stroke:"#6b7280"}),(0,b.jsx)(H.YAxis,{stroke:"#6b7280"}),(0,b.jsx)(J.Tooltip,{content:(0,b.jsx)(function({active:a,payload:c,label:d}){if(!a||!c||!c.length)return null;let e=c.find(a=>"equity"===a.dataKey)||c[0],f=c.find(a=>"drawdown"===a.dataKey);return(0,b.jsxs)("div",{className:"bg-gray-900 p-2 rounded text-sm text-white",children:[(0,b.jsx)("div",{className:"font-bold",children:d}),e&&(0,b.jsxs)("div",{children:["Equity: ",(0,b.jsx)("span",{className:"font-mono",children:e.value})]}),f&&(0,b.jsxs)("div",{children:["Drawdown: ",(0,b.jsx)("span",{className:"font-mono",children:f.value})]})]})},{})}),(0,b.jsx)(f.Area,{type:"monotone",dataKey:"drawdown",fill:"#7c3aed",fillOpacity:.06,stroke:"none"}),(0,b.jsx)(e.Line,{type:"monotone",dataKey:"equity",stroke:"#06b6d4",strokeWidth:3,dot:!1,strokeOpacity:.98,isAnimationActive:!0,animationDuration:1200}),(0,b.jsx)(e.Line,{type:"monotone",dataKey:"drawdown",stroke:"#7c3aed",strokeWidth:2,dot:!1,strokeOpacity:.6,isAnimationActive:!0,animationDuration:1e3}),k&&(0,b.jsx)(A,{x:k.date,y:k.equity,r:6,fill:"#06b6d4",stroke:"#fff",strokeWidth:1}),l&&(0,b.jsx)(A,{x:l.date,y:l.equity,r:6,fill:"#7c3aed",stroke:"#fff",strokeWidth:1})]})})]}),i.dailyPnL.length>0&&(0,b.jsxs)("div",{className:"card-glass rounded-lg p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-200 mb-4",children:"Daily P&L"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(N,{selector:".recharts-wrapper",filename:`daily-pnl-${new Date().toISOString().slice(0,10)}.png`}),(0,b.jsx)(O,{trades:a,chartSelector:".recharts-wrapper"})]})]}),(0,b.jsx)(L.ResponsiveContainer,{width:"100%",height:300,children:(0,b.jsxs)(d.LineChart,{data:i.dailyPnL,children:[(0,b.jsx)(I.CartesianGrid,{strokeDasharray:"3 3",stroke:"#111827"}),(0,b.jsx)(G.XAxis,{dataKey:"date",stroke:"#6b7280"}),(0,b.jsx)(H.YAxis,{stroke:"#6b7280"}),(0,b.jsx)(J.Tooltip,{contentStyle:{backgroundColor:"#0b1220",border:"none",borderRadius:"0.5rem",color:"#fff"}}),(0,b.jsx)(e.Line,{type:"monotone",dataKey:"pnl",stroke:"#3b82f6",dot:{fill:"#3b82f6"},isAnimationActive:!0,strokeWidth:2})]})})]}),i.pairPerformance.length>0&&(0,b.jsxs)("div",{className:"card-glass rounded-lg p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-200 mb-4",children:"Performance by Pair"}),(0,b.jsx)(L.ResponsiveContainer,{width:"100%",height:300,children:(0,b.jsxs)(B.BarChart,{data:i.pairPerformance,children:[(0,b.jsx)(I.CartesianGrid,{strokeDasharray:"3 3",stroke:"#111827"}),(0,b.jsx)(G.XAxis,{dataKey:"pair",stroke:"#6b7280"}),(0,b.jsx)(H.YAxis,{stroke:"#6b7280"}),(0,b.jsx)(J.Tooltip,{contentStyle:{backgroundColor:"#0b1220",border:"none",borderRadius:"0.5rem",color:"#fff"}}),(0,b.jsx)(K.Legend,{}),(0,b.jsx)(C.Bar,{dataKey:"wins",fill:"#10b981"}),(0,b.jsx)(C.Bar,{dataKey:"losses",fill:"#ef4444"})]})})]}),i.directionPerformance.length>0&&(0,b.jsxs)("div",{className:"card-glass rounded-lg p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-200 mb-4",children:"Win Rate by Direction"}),(0,b.jsx)(L.ResponsiveContainer,{width:"100%",height:300,children:(0,b.jsxs)(D.PieChart,{children:[(0,b.jsx)(E.Pie,{data:i.directionPerformance,cx:"50%",cy:"50%",labelLine:!1,label:({name:a})=>a,outerRadius:80,fill:"#8884d8",dataKey:"value",children:i.directionPerformance.map((a,c)=>(0,b.jsx)(F.Cell,{fill:m[c%m.length]},`cell-${c}`))}),(0,b.jsx)(J.Tooltip,{contentStyle:{backgroundColor:"#0b1220",border:"none",borderRadius:"0.5rem",color:"#fff"}})]})})]})]})}function Q({trades:a,onSelectRange:d}){let e=(0,c.useMemo)(()=>{let b={},c=new Date;for(let a=0;a<365;a++){let d=new Date(c);d.setDate(c.getDate()-a),b[d.toISOString().slice(0,10)]=0}return a.forEach(a=>{let c=function(a){if(!a)return null;let b=new Date("number"==typeof a?a:String(a));return!(b instanceof Date)||isNaN(b.getTime())?null:b.toISOString().slice(0,10)}(a.entryTime);c&&void 0!==b[c]&&(b[c]=(b[c]||0)+(a.profitLoss||0))}),Object.entries(b).map(([a,b])=>({day:a,pnl:b}))},[a]),f=Math.max(...e.map(a=>Math.abs(a.pnl)),1),[g,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(null),k=(0,c.useRef)(!0);(0,c.useEffect)(()=>{if(d){if(k.current){k.current=!1;return}d({start:g,end:i})}},[g,i]);let[l,m]=(0,c.useState)(!1);function n(a){if(l){let b=new Date(a),c=new Date(b.getFullYear(),b.getMonth(),1).toISOString().slice(0,10),d=new Date(b.getFullYear(),b.getMonth()+1,0).toISOString().slice(0,10);h(c),j(d);return}if(!g){h(a),j(null);return}if(g&&!i){if(a===g){h(null),j(null);return}let b=new Date(g);new Date(a)<b?(h(a),j(b.toISOString().slice(0,10))):j(a);return}h(a),j(null)}return(0,b.jsxs)("div",{className:"card-glass p-4 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-200 mb-4",children:"Yearly P&L Heatmap"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"text-xs text-gray-400",children:[g&&(0,b.jsxs)("span",{children:["From ",(0,b.jsx)("strong",{children:g})]})," ",i&&(0,b.jsxs)("span",{children:[" to ",(0,b.jsx)("strong",{children:i})]}),(g||i)&&(0,b.jsx)("button",{className:"ml-3 text-sm text-blue-400",onClick:()=>{h(null),j(null),d&&d({start:null,end:null})},children:"Clear"})]}),(0,b.jsx)("button",{type:"button","aria-pressed":l,"aria-label":"Toggle month zoom",className:`px-2 py-1 rounded ${l?"bg-indigo-600 text-white":"bg-transparent text-gray-300 border border-gray-700"}`,onClick:()=>m(a=>!a),children:l?"Month Zoom: ON":"Month Zoom: OFF"})]})]}),(0,b.jsx)("div",{className:"grid grid-cols-52 gap-1",role:"grid","aria-label":"Yearly profit/loss heatmap",style:{gap:"6px"},children:e.map(a=>{let c=Math.min(1,Math.abs(a.pnl)/f),d=a.pnl>0?`rgba(16,185,129,${.14+.86*c})`:a.pnl<0?`rgba(239,68,68,${.14+.86*c})`:"transparent",e=function(a){if(!g)return!1;if(g&&!i)return a===g;let b=new Date(g),c=new Date(i),d=new Date(a);return d>=b&&d<=c}(a.day),h=Math.abs(a.pnl)>.25*f;return(0,b.jsx)("button",{title:`${a.day}: ${a.pnl}`,"aria-pressed":e,onClick:()=>n(a.day),onKeyDown:b=>{("Enter"===b.key||" "===b.key)&&(b.preventDefault(),n(a.day))},style:{background:d,width:"36px",height:"36px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--foreground)",fontSize:"11px",...e?{boxShadow:"0 0 0 3px rgba(99,102,241,0.12)",outline:"none"}:{}},className:"focus:outline-none",children:h?a.pnl>0?`+$${Math.round(a.pnl)}`:`-$${Math.abs(Math.round(a.pnl))}`:""},a.day)})}),(0,b.jsx)("div",{className:"text-xs text-gray-400 mt-2",children:"Green = Profit, Pink = Loss. Click a day to set start, click another to set end. Toggle Month Zoom to select whole month on click. Clear to reset selection."})]})}function R({trades:a}){let d=(0,c.useMemo)(()=>{let b={};return a.forEach(a=>{let c=new Date(a.entryTime),d=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`;b[d]||(b[d]={pnl:0,trades:[]}),b[d].pnl+=a.profitLoss||0,b[d].trades.push(a)}),Object.entries(b).sort((a,b)=>b[0].localeCompare(a[0]))},[a]),[e,f]=(0,c.useState)({});return(0,b.jsxs)("div",{className:"card-glass p-4 rounded-lg",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-200 mb-4",children:"Monthly Performance"}),(0,b.jsx)("div",{className:"space-y-2",children:d.map(([a,c])=>(0,b.jsxs)("div",{className:"border border-transparent hover:border-gray-700 rounded-lg p-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>f(b=>({...b,[a]:!b[a]})),children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-gray-300 font-medium",children:a}),(0,b.jsxs)("div",{className:"text-xs text-gray-400",children:[c.trades.length," trades"]})]}),(0,b.jsx)("div",{className:`text-lg font-bold ${c.pnl>=0?"text-green-400":"text-red-400"}`,children:c.pnl.toFixed(2)})]}),e[a]&&(0,b.jsx)("div",{className:"mt-2 text-sm text-gray-300",children:c.trades.map((a,c)=>(0,b.jsxs)("div",{className:"py-1 border-t border-gray-800",children:[new Date(a.entryTime).toLocaleString()," — ",a.pair," — ",a.profitLoss]},c))})]},a))})]})}var S=a.i(42029),T=a.i(6704),U=a.i(71297);function V(){let{theme:a,toggleTheme:d}=(0,S.useTheme)(),[e,f]=(0,c.useState)([]),[g,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)({start:null,end:null});return((0,c.useEffect)(()=>{h(!0)},[]),(0,c.useEffect)(()=>{g&&(async()=>{try{let a=await fetch("/api/trades",{headers:{"x-user-id":"demo-user"}});if(!a.ok){let b=null;try{b=await a.json()}catch(c){b=await a.text()}console.error("Failed to fetch trades:",a.status,b),f([]);return}let b=await a.json();if(!Array.isArray(b)){console.warn("Unexpected trades payload in analytics page",b),f([]);return}f(b)}catch(a){console.error("Error fetching trades:",a)}})()},[g]),g)?(0,b.jsxs)("div",{className:"min-h-screen bg-white dark:bg-slate-950",children:[(0,b.jsxs)("main",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Analytics & Insights"}),(0,b.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Track your trading performance with detailed charts and metrics"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,b.jsx)(U.default,{className:"flex-1 p-4",children:(0,b.jsx)(P,{trades:e,startDate:i.start,endDate:i.end})}),(0,b.jsxs)("div",{className:"ml-auto text-sm text-gray-400",children:[i.start&&(0,b.jsxs)("div",{children:["Selected: ",(0,b.jsx)("strong",{children:i.start})," ",i.end&&(0,b.jsxs)("span",{children:["— ",(0,b.jsx)("strong",{children:i.end})]})]}),!i.start&&!i.end&&(0,b.jsx)("div",{className:"text-gray-500",children:"No date range selected"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-8",children:[(0,b.jsx)(U.default,{className:"p-4",children:(0,b.jsx)(Q,{trades:e,onSelectRange:j})}),(0,b.jsx)(U.default,{className:"p-4",children:(0,b.jsx)(R,{trades:e})})]})]}),(0,b.jsx)(T.Toaster,{position:"bottom-right"})]}):(0,b.jsx)("div",{className:"min-h-screen bg-white dark:bg-slate-950"})}a.s(["default",()=>V],16683)}];

//# sourceMappingURL=src_app_analytics_page_tsx_5c2fe4d5._.js.map