module.exports=[47137,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(76597),e=a.i(6704),f=a.i(27348);function g({onRecordingSaved:a}){let d=(0,c.useRef)(null),g=(0,c.useRef)([]),[h,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(0),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)(null);(0,c.useEffect)(()=>{let a;return h&&(a=setInterval(()=>{k(a=>a+1)},1e3)),()=>clearInterval(a)},[h]);let p=async()=>{try{let b=await navigator.mediaDevices.getUserMedia({audio:!0});d.current=new MediaRecorder(b),g.current=[],d.current.ondataavailable=a=>{g.current.push(a.data)},d.current.onstop=()=>{let b=new Blob(g.current,{type:"audio/webm"}),c=URL.createObjectURL(b),d={id:Date.now().toString(),url:c,duration:j,timestamp:new Date};m(a=>[d,...a]),a?.(c)},d.current.start(),i(!0),k(0)}catch(a){e.default.error("Unable to access microphone"),console.error(a)}},q=a=>{let b=Math.floor(a/60);return`${b}:${(a%60).toString().padStart(2,"0")}`};return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-6 border border-gray-200 dark:border-slate-700",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Voice Notes"}),(0,b.jsx)("div",{className:"flex items-center gap-4 mb-4",children:h?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("button",{onClick:()=>{d.current&&h&&(d.current.stop(),i(!1),d.current.stream.getTracks().forEach(a=>a.stop()))},className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors",children:[(0,b.jsx)(f.FiStopCircle,{className:"w-5 h-5"}),"Stop"]}),(0,b.jsx)("div",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:q(j)}),(0,b.jsx)("div",{className:"flex-1 h-1 bg-red-300 dark:bg-red-900 rounded-full relative overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-red-600 animate-pulse",style:{width:"30%"}})})]}):(0,b.jsxs)("button",{onClick:p,className:"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors",children:[(0,b.jsx)(f.FiMic,{className:"w-5 h-5"}),"Start Recording"]})}),l.length>0&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Recordings"}),l.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 dark:bg-slate-700 p-3 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,b.jsx)("button",{onClick:()=>o(n===a.id?null:a.id),className:"btn-compact bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors",children:(0,b.jsx)(f.FiPlay,{className:"w-4 h-4"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.timestamp.toLocaleTimeString()}),(0,b.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:q(a.duration)})]})]}),(0,b.jsx)("button",{onClick:()=>{var b;return b=a.id,void m(a=>a.filter(a=>a.id!==b))},className:"p-2 rounded-lg text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors",children:(0,b.jsx)(f.FiTrash2,{className:"w-4 h-4"})})]},a.id))]})]}),n&&(0,b.jsx)("audio",{src:l.find(a=>a.id===n)?.url,autoPlay:!0,controls:!0,className:"w-full"},n)]})}function h({onScreenshotAdded:a}){let d=(0,c.useRef)(null),[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(""),m=async b=>{let c=b.currentTarget.files;if(c){for(let b of Array.from(c))try{let c=new FileReader;c.onload=b=>{let c=b.target?.result,d={id:Date.now().toString()+Math.random(),url:c,caption:"",timestamp:new Date};h(a=>[d,...a]),a?.(c),e.default.success("Screenshot uploaded")},c.readAsDataURL(b)}catch(a){e.default.error("Failed to upload screenshot"),console.error(a)}d.current&&(d.current.value="")}},n=(a,b)=>{h(c=>c.map(c=>c.id===a?{...c,caption:b}:c)),j(null)};return(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-6 border border-gray-200 dark:border-slate-700",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Trade Setup Screenshots"}),(0,b.jsxs)("div",{onClick:()=>d.current?.click(),className:"border-2 border-dashed border-gray-300 dark:border-slate-600 rounded-lg p-6 text-center cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors",children:[(0,b.jsx)(f.FiUpload,{className:"w-8 h-8 mx-auto mb-2 text-gray-600 dark:text-gray-400"}),(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Click to upload or drag & drop"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PNG, JPG, GIF up to 10MB"}),(0,b.jsx)("input",{ref:d,type:"file",multiple:!0,accept:"image/*",onChange:m,className:"hidden"})]}),g.length>0&&(0,b.jsxs)("div",{className:"mt-6",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4",children:"Uploads"}),(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:g.map(a=>(0,b.jsxs)("div",{className:"relative group bg-gray-100 dark:bg-slate-700 rounded-lg overflow-hidden",children:[(0,b.jsx)("img",{src:a.url,alt:"Trade setup",className:"w-full h-40 object-cover"}),(0,b.jsxs)("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-between p-2",children:[(0,b.jsx)("button",{onClick:()=>{var b,c;let d;return b=a.url,c=a.timestamp,void((d=document.createElement("a")).href=b,d.download=`trade-setup-${c.toISOString()}.png`,document.body.appendChild(d),d.click(),document.body.removeChild(d))},className:"btn-compact bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors",title:"Download",children:(0,b.jsx)(f.FiDownload,{className:"w-4 h-4"})}),(0,b.jsx)("button",{onClick:()=>{var b;return b=a.id,void h(a=>a.filter(a=>a.id!==b))},className:"p-2 rounded-lg bg-red-600 hover:bg-red-700 text-white transition-colors",title:"Delete",children:(0,b.jsx)(f.FiX,{className:"w-4 h-4"})})]}),(0,b.jsx)("div",{className:"p-3 bg-white dark:bg-slate-800 border-t border-gray-200 dark:border-slate-600",children:i===a.id?(0,b.jsx)("input",{autoFocus:!0,type:"text",value:k,onChange:a=>l(a.target.value),onBlur:()=>n(a.id,k),onKeyPress:b=>{"Enter"===b.key&&n(a.id,k)},placeholder:"Add caption...",className:"w-full px-2 py-1 border border-gray-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-gray-900 dark:text-white text-xs focus:ring-2 focus:ring-blue-500 outline-none"}):(0,b.jsx)("p",{onClick:()=>{j(a.id),l(a.caption)},className:"text-xs text-gray-600 dark:text-gray-400 cursor-pointer hover:text-gray-900 dark:hover:text-white",children:a.caption||"Click to add caption..."})})]},a.id))})]})]})})}var i=a.i(71297);function j(){let[a,f]=(0,c.useState)(!1),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)({whatLearned:"",mistakes:[],emotionalState:"calm",setupQuality:3}),[p,q]=(0,c.useState)("");(0,c.useEffect)(()=>{f(!0)},[]),(0,c.useEffect)(()=>{a&&(async()=>{try{let a=await fetch("/api/trades",{headers:{"x-user-id":"demo-user"}});if(!a.ok){let b=null;try{b=await a.json()}catch(c){b=await a.text()}console.error("Failed to fetch trades:",a.status,b),m([]);return}let b=await a.json();if(!Array.isArray(b)){console.warn("Unexpected trades payload in review page",b),m([]);return}m(b)}catch(a){console.error("Error fetching trades:",a)}})()},[a]);let r=l.find(a=>a.id===j),s=async()=>{if(r)try{(await fetch(`/api/trades/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json","x-user-id":"demo-user"},body:JSON.stringify({whatLearned:n.whatLearned,mistakes:JSON.stringify(n.mistakes),emotionalState:n.emotionalState,setupQuality:n.setupQuality})})).ok&&(e.default.success("Review saved"),k(null))}catch(a){e.default.error("Failed to save review")}};return a?(0,b.jsxs)("div",{className:"min-h-screen bg-white dark:bg-slate-950",children:[(0,b.jsx)(d.default,{}),(0,b.jsxs)("main",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Trade Reviews"}),(0,b.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Deep dive into your trades and learn from them"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,b.jsxs)(i.default,{className:"bg-white dark:bg-slate-800 p-4 border border-gray-200 dark:border-slate-700",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Recent Trades"}),(0,b.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:l.length>0?l.map(a=>(0,b.jsxs)("button",{onClick:()=>{k(a.id),o({whatLearned:a.whatLearned||"",mistakes:a.mistakes?JSON.parse(a.mistakes):[],emotionalState:a.emotionalState||"calm",setupQuality:a.setupQuality||3})},className:`w-full text-left p-3 rounded-lg transition-colors ${j===a.id?"bg-blue-600 text-white":"bg-gray-50 dark:bg-slate-700 text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-slate-600"}`,children:[(0,b.jsx)("div",{className:"font-semibold text-sm",children:a.pair}),(0,b.jsx)("div",{className:"text-xs opacity-75",children:new Date(a.entryTime).toLocaleDateString()})]},a.id)):(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"No trades yet"})})]}),r?(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,b.jsxs)(i.default,{className:"bg-white dark:bg-slate-800 p-4 border border-gray-200 dark:border-slate-700",children:[(0,b.jsxs)("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:[r.pair," - ",r.direction]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Entry"}),(0,b.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:r.entryPrice.toFixed(5)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Exit"}),(0,b.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:r.exitPrice?.toFixed(5)||"Open"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"P&L"}),(0,b.jsx)("p",{className:`font-semibold ${r.profitLoss>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:r.profitLoss?.toFixed(2)||"N/A"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Outcome"}),(0,b.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:r.outcome||"Open"})]})]})]}),(0,b.jsxs)(i.default,{className:"bg-white dark:bg-slate-800 p-4 border border-gray-200 dark:border-slate-700",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Review Details"}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"What I Learned"}),(0,b.jsx)("textarea",{value:n.whatLearned,onChange:a=>o(b=>({...b,whatLearned:a.target.value})),placeholder:"What did this trade teach you?",className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none resize-none h-20"})]}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Emotional State"}),(0,b.jsxs)("select",{value:n.emotionalState,onChange:a=>o(b=>({...b,emotionalState:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[(0,b.jsx)("option",{children:"calm"}),(0,b.jsx)("option",{children:"rushed"}),(0,b.jsx)("option",{children:"frustrated"}),(0,b.jsx)("option",{children:"confident"}),(0,b.jsx)("option",{children:"fearful"})]})]}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Setup Quality Rating"}),(0,b.jsxs)("select",{value:n.setupQuality,onChange:a=>o(b=>({...b,setupQuality:parseInt(a.target.value)})),className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 outline-none",children:[(0,b.jsx)("option",{value:"1",children:"⭐ Poor"}),(0,b.jsx)("option",{value:"2",children:"⭐⭐ Below Average"}),(0,b.jsx)("option",{value:"3",children:"⭐⭐⭐ Average"}),(0,b.jsx)("option",{value:"4",children:"⭐⭐⭐⭐ Good"}),(0,b.jsx)("option",{value:"5",children:"⭐⭐⭐⭐⭐ Excellent"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Mistakes Made"}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-2",children:["Overtraded","Broke rules","Wrong entry point","Hesitated on trade","Exited too early","Exited too late","Ignored analysis","Bad position sizing","Emotion-driven"].map(a=>(0,b.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,b.jsx)("input",{type:"checkbox",checked:n.mistakes.includes(a),onChange:()=>{o(b=>({...b,mistakes:b.mistakes.includes(a)?b.mistakes.filter(b=>b!==a):[...b.mistakes,a]}))},className:"w-4 h-4 rounded border-gray-300 dark:border-slate-600"}),(0,b.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:a})]},a))})]})]}),(0,b.jsx)("button",{onClick:s,className:"w-full btn-primary disabled:opacity-50 transition-colors text-center",children:"Save Review"})]}):(0,b.jsx)(i.default,{className:"lg:col-span-2 bg-white dark:bg-slate-800 p-6 text-center border border-gray-200 dark:border-slate-700",children:(0,b.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Select a trade to review"})})]}),r&&(0,b.jsxs)("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,b.jsx)(i.default,{className:"p-6",children:(0,b.jsx)(g,{})}),(0,b.jsx)(i.default,{className:"p-6",children:(0,b.jsx)(h,{})})]})]}),(0,b.jsx)(e.Toaster,{position:"bottom-right"})]}):(0,b.jsx)("div",{className:"min-h-screen bg-white dark:bg-slate-950"})}a.s(["default",()=>j],47137)}];

//# sourceMappingURL=src_app_review_page_tsx_d97b6247._.js.map